<%@ page import="java.sql.*" %>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%!
	Connection connection = null;
	PreparedStatement preparedStatement = null;

	final String URL = "jdbc:oracle:thin:@192.168.0.2:1521:XE";
	final String ID = "c##park";
	final String PASSWORD = "park";

	final String INSERT_SQL = 
		    "INSERT INTO PRODUCT(productId, productName, manufacturer, expirationDate, isAdultOnly, price, quantity) " +
		    "VALUES (?, ?, ?, TO_DATE(?, 'YYYY-MM-DD'), ?, ?, ?)";

%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PRODUCT í…Œì´ë¸” ë°ì´í„° ì…ë ¥</title>
</head>
<body>
<%
	request.setCharacterEncoding("UTF-8");

	// í¼ì—ì„œ ë„˜ì–´ì˜¨ ê°’ ë°›ê¸°
	final int PRODUCT_ID = Integer.parseInt(request.getParameter("product_id"));
	final String PRODUCT_NAME = request.getParameter("product_name");
	final String MANUFACTURER = request.getParameter("manufacturer");
	final String EXPIRATION_DATE = request.getParameter("expiration_date"); // YYYY-MM-DD í˜•ì‹
	final String IS_ADULT_ONLY = request.getParameter("is_adult_only");     // 'Y' or 'N'
	final int PRICE = Integer.parseInt(request.getParameter("price"));
	final int QUANTITY = Integer.parseInt(request.getParameter("quantity"));

	try {
		Class.forName("oracle.jdbc.driver.OracleDriver");
		connection = DriverManager.getConnection(URL, ID, PASSWORD);

		preparedStatement = connection.prepareStatement(INSERT_SQL);
		preparedStatement.setInt(1, PRODUCT_ID);
		preparedStatement.setString(2, PRODUCT_NAME);
		preparedStatement.setString(3, MANUFACTURER);
		preparedStatement.setString(4, EXPIRATION_DATE);
		preparedStatement.setString(5, IS_ADULT_ONLY);
		preparedStatement.setInt(6, PRICE);
		preparedStatement.setInt(7, QUANTITY);

		preparedStatement.executeUpdate();
%>
	<h2>âœ… PRODUCT í…Œì´ë¸”ì— ë°ì´í„° ì…ë ¥ ì„±ê³µ</h2>
	<a href="db1_select_product.jsp">ğŸ“¦ product í…Œì´ë¸” ë³´ê¸°</a>
<%
	} catch (Exception e) {
		out.println("<p style='color:red;'>âŒ DB ì˜¤ë¥˜: " + e.getMessage() + "</p>");
		e.printStackTrace();
	} finally {
		try {
			if (preparedStatement != null) preparedStatement.close();
			if (connection != null) connection.close();
		} catch (Exception e) {
			out.println("<p>âš  DB ì—°ê²° í•´ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</p>");
		}
	}
%>
</body>
</html>
